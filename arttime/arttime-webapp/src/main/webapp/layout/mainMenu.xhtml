<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:rich="http://richfaces.org/rich"
                xmlns:fn="http://java.sun.com/jsp/jstl/functions"
                xmlns:arttime="http://java.sun.com/jsf/composite/components">

    <script type="text/javascript">
        //<![CDATA[
        $(document).ready(function () {
            var menuItems = $("td[id^='mainMenuForm:']");
            $.each(menuItems, function (key, value) {
                if ($(value).find("div.activeMenuItem").length > 0) {
                    $(value).addClass("selectedItem");
                } else {
                    $(value).removeClass("selectedItem");
                }
            });

        });

        function clickLink(linkId) {
            document.getElementById(linkId).click();
        }

        //]]>
    </script>

    <h:form id="mainMenuForm">
        <rich:toolbar id="mainMenu" itemSeparator="none">
            <rich:toolbarGroup location="left" itemClass="selectedItem" id="mainMenuGroup">
                <rich:menuItem onclick="return false;"/>
                <rich:menuItem onclick="clickLink('mainMenuForm:timesheetLink'); return false"
                               styleClass="#{fn:startsWith(view.viewId, '/pages/timesheet') ? 'activeMenuItem' : ''}
                                            main-menu-toolbar-item">
                    <h:link id="timesheetLink" value="#{messages['mainMenu.timesheet']}" outcome="timesheet"/>
                </rich:menuItem>
                <rich:menuItem onclick="clickLink('mainMenuForm:manageEffortsLink'); return false"
                               rendered="#{request.isUserInRole('exec') or request.isUserInRole('pm')
                                           or request.isUserInRole('officeManager')}"
                               styleClass="#{fn:startsWith(view.viewId, '/pages/manageEfforts') ? 'activeMenuItem' : ''}
                                            main-menu-toolbar-item">
                    <h:link id="manageEffortsLink" value="#{messages['mainMenu.manageEfforts']}"
                            outcome="manageEfforts"/>
                </rich:menuItem>
                <rich:menuItem onclick="clickLink('mainMenuForm:reportsLink'); return false"
                               rendered="#{request.isUserInRole('exec') or request.isUserInRole('pm')
                                         or request.isUserInRole('officeManager') or request.isUserInRole('accountant')}"
                               styleClass="#{fn:startsWith(view.viewId, '/pages/reports') ? 'activeMenuItem' : ''}
                                            main-menu-toolbar-item">
                    <h:link id="reportsLink" value="#{messages['mainMenu.reports']}" outcome="reports"/>
                </rich:menuItem>
                <rich:dropDownMenu label="#{messages['mainMenu.dictionaries']}"
                                   rendered="#{request.isUserInRole('exec') or request.isUserInRole('pm')
                                             or request.isUserInRole('officeManager')}"
                                   styleClass="#{(fn:startsWith(view.viewId, '/pages/project')
                                                or fn:startsWith(view.viewId, '/pages/employee')
                                                or fn:startsWith(view.viewId, '/pages/calendar')
                                                or fn:startsWith(view.viewId, '/pages/access')
                                                or fn:startsWith(view.viewId, '/pages/hourType')) ? 'activeMenuItem' : ''}">
                    <rich:menuItem onclick="clickLink('mainMenuForm:projectsLink'); return false"
                                   rendered="#{request.isUserInRole('exec') or request.isUserInRole('pm')}"
                                   styleClass="main-menu-toolbar-item">
                        <h:link id="projectsLink" value="#{messages['mainMenu.projects']}" outcome="projects"/>
                    </rich:menuItem>
                    <rich:menuItem onclick="clickLink('mainMenuForm:employeesLink'); return false"
                                   styleClass="main-menu-toolbar-item"
                                   rendered="#{request.isUserInRole('exec') or request.isUserInRole('officeManager')}">
                        <h:link id="employeesLink" value="#{messages['mainMenu.employees']}" outcome="employees"/>
                    </rich:menuItem>
                    <rich:menuItem onclick="clickLink('mainMenuForm:calendarsLink'); return false"
                                   styleClass="main-menu-toolbar-item"
                                   rendered="#{request.isUserInRole('exec') or request.isUserInRole('officeManager')}">
                        <h:link id="calendarsLink" value="#{messages['mainMenu.calendars']}" outcome="calendars"/>
                    </rich:menuItem>
                    <rich:menuItem onclick="clickLink('mainMenuForm:hourTypesLink'); return false"
                                   styleClass="main-menu-toolbar-item"
                                   rendered="#{request.isUserInRole('exec')}">
                        <h:link id="hourTypesLink" value="#{messages['mainMenu.hourTypes']}" outcome="hourTypes"/>
                    </rich:menuItem>
                    <rich:menuItem onclick="clickLink('mainMenuForm:synchronizationLink'); return false"
                                   rendered="#{request.isUserInRole('exec')}"
                                   styleClass="main-menu-toolbar-item">
                        <h:link id="accessToDepartmentsLink" value="#{messages['mainMenu.accessToDepartments']}"
                                outcome="accessToDepartments"/>
                    </rich:menuItem>
                </rich:dropDownMenu>
                <rich:menuItem onclick="clickLink('mainMenuForm:notificationsLink'); return false"
                               rendered="#{request.isUserInRole('exec') or request.isUserInRole('officeManager')}"
                               styleClass="#{fn:startsWith(view.viewId, '/pages/notifications') ? 'activeMenuItem' : ''}
                                           main-menu-toolbar-item">
                    <h:link id="notificationsLink" value="#{messages['mainMenu.workTimeProblems']}"
                            outcome="actualTimeProblemsNotification"/>
                </rich:menuItem>
                <rich:dropDownMenu label="#{messages['mainMenu.settings']}"
                                   rendered="#{request.isUserInRole('admin')}"
                                   styleClass="#{fn:startsWith(view.viewId, '/pages/settings') ? 'activeMenuItem' : ''}">
                    <rich:menuItem onclick="clickLink('mainMenuForm:externalDataProvidersLink'); return false"
                                   styleClass="main-menu-toolbar-item">
                        <h:link id="externalDataProvidersLink"
                                value="#{messages['mainMenu.settings.externalDataProviders']}"
                                outcome="externalDataProviders"/>
                    </rich:menuItem>
                    <rich:menuItem onclick="clickLink('mainMenuForm:synchronizationLink'); return false"
                                   styleClass="main-menu-toolbar-item">
                        <h:link id="synchronizationLink" value="#{messages['mainMenu.settings.synchronization']}"
                                outcome="synchronization"/>
                    </rich:menuItem>
                    <rich:menuItem onclick="clickLink('mainMenuForm:smtpLink'); return false"
                                   styleClass="main-menu-toolbar-item">
                        <h:link id="smtpLink" value="#{messages['mainMenu.settings.smtp']}" outcome="smtp"/>
                    </rich:menuItem>
                    <rich:menuItem onclick="clickLink('mainMenuForm:notificationLink'); return false"
                                   styleClass="main-menu-toolbar-item">
                        <h:link id="notificationLink" value="#{messages['mainMenu.settings.notification']}"
                                outcome="notification"/>
                    </rich:menuItem>
                    <rich:menuItem onclick="clickLink('mainMenuForm:linksLink'); return false"
                                   styleClass="main-menu-toolbar-item">
                        <h:link id="linksLink" value="#{messages['mainMenu.settings.links']}" outcome="links"/>
                    </rich:menuItem>
                </rich:dropDownMenu>
            </rich:toolbarGroup>
            <rich:toolbarGroup location="right" itemClass="selectedItem"
                               rendered="#{settingsBean.settings.helpPageUrl != null}">
                <a href="#{settingsBean.settings.helpPageUrl}" target="blank" class="rf-ddm-itm rf-ddm-itm-href">
                    #{messages['mainMenu.help']}
                </a>
            </rich:toolbarGroup>
            <rich:toolbarGroup location="right" itemClass="unselectMenu">
                <rich:menuItem onclick="return false;" styleClass="menuSeparatorRight"
                               rendered="#{fn:startsWith(view.viewId, '/pages/timesheet')}"/>
                <arttime:reportedHoursIndicator rendered="#{fn:startsWith(view.viewId, '/pages/timesheet')}"/>
                <rich:menuItem
                        label="#{p:userPrincipal().name}"
                        title="#{messages['mainMenu.logout.title']}"
                        action="#{loginBean.logout()}"
                        onclick="window.loggingOut = true; return true;"
                        icon="fa-sign-out"
                        styleClass="signout">
                    <f:facet name="icon">
                        <i class="fa fa-sign-out"/>
                    </f:facet>
                </rich:menuItem>
            </rich:toolbarGroup>
        </rich:toolbar>
    </h:form>
</ui:composition>